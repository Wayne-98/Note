---
title: 高性能MySQL第十章：复制
date: {date}
tags: MySQL
categories: 高性能MySQL
---
## 复制概述

基于行的复制和基于语句的复制，都是通过在主库上记录二进制日志，在备库重放日志的方式来实现异步的数据复制。

### 复制解决的问题

1. 数据分布
2. 负载均衡
3. 备份
4. 高可用性和故障切换
5. MySQL升级测试

### 复制如何工作

* 在主库上把数据更改记录到二进制日志中

在每次准备提交事务完成数据更新前，主库将数据更新的事件记录到二进制日志中。

* 备库将主库上的日志复制到自己的中继日志中

首先，备库会启动一个 I/O 线程，该线程和主库建立一个普通的客户端连接

然后在主库中建立启动一个特殊的二进制转储线程，该线程会读取主库上二进制日志中的事件。（wait，notify）

* 备库读取中继日志中的事件，将其重放到备库数据之上



这种复制架构实现了事件的获取和重返事件的解耦，允许这两个过程异步进行。也就是 I/O 线程能够独立于 SQL 线程之外工作。



主库上并发运行的查询到备库上只能串行化执行，因为只有一个 SQL 线程来重放中继日志中的事件