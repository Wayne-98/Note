---
title: 自顶向下方法：网络层-控制平面
date: {date}
tags: 计算机网络
categories: 计算机网络
---

## 路由选择算法

* 集中式路由选择算法：拥有关于连通性和链路开销的全部完整信息。
  * 链路状态(Link State, LS)算法：具有全局状态信息的算法
* 分散式路由选择算法：没有关于连通性和链路开销的全部完整信息，每个节点仅有与其直接相连链路的开销知识即可开始工作。路由器通过迭代计算过程以及与相邻节点的信息交换，一个节点逐渐计算出达到某目的地的节点或者一组节点的最低开销路径。
  * 距离向量(Distance-Vector, DV)算法：分散式路由选择算法。（每个节点维护到网络中所有其他节点的开销估计的向量）

### 因特网中自制系统内部的路由选择：OSPF

* 自制系统(Autonomous System, AS)：通常在一个 ISP 中的路由器以及互联它们的链路构成一个 AS，每个 AS 由一组通常处在相同管理下的路由器组成。

* OSPF （Open Shortest Path Frist）：链路状态协议，使用洪泛链路状态信息和 Dijkstra 最低开销路径算法。每当一条链路的状态发生改变时，路由器就会广播链路状态信息。如未发生变化，也需要周期性的广播链路状态。
  * 优点
    1. 安全：仅有受信任的路由器能参与一个 AS 内部的 OSPF 协议。
    2. 多条相同开销的路径：当存在多条相等开销的路径时，无须仅选择单一的路径来承载所有的流量
    3. 对单播和多播路由选择的综合支持：MOSPF 
    4. 支持在单个 AS 中的层次结构：可以层次化的配置多个区域，每个区域都运行自己的 OSPF 链路状态路由选择算法。

## ISP 之间的路由选择：BGP

自治系统间路由选择协议：在因特网中，所有的 AS 运行相同的 AS 间路由选择协议，称为**边界网关协议**(Broder Gateway Protocal, BGP)。

* BGP 的作用：作为一种 AS 间的路由选择协议，BGP 为每台路由器提供了一种完成以下任务的手段：

  1. 从邻居 AS 获得前缀的可达性信息。
  2. 确定到该前缀的“最好的”路由。

* 通告 BGP 路由信息：

  * 网关路由器
  * 内部路由器
  * 在 BGP 中，每对路由器通过使用 179 端口的半永久 TCP 连接交换路由选择信息
  * 跨越两个 AS 的 BGP 连接称为外部 BGP 连接
  * 在相同 AS 中的两个路由器之间的 BGP 会话称为内部 BGP 连接。

* 确定最好的路由：

  * 路由器通过 BGP 连接通告前缀的时候，它在前缀中包括一些 BGP 属性。前缀及其属性称为**路由**。
  * 两个较为重要的属性是 AS-PATH 和 NEXT-HOP。

  > 路由器 2a 的最左侧接口的 IP 地址：AS2, AS3; x
  >
  > 路由器 3d 的最左侧接口的 IP 地址：AS3; x

* 热土豆路由选择

在路由器转发表中增加 AS 外部目的地的步骤：

	1. 从 AS 间协议学到经过多个网关可达子网 x
 	2. 使用来自 AS 内部协议的路由选择信息，以决定到达每个网关的最低开销路径的开销
 	3. 热土豆路由选择：选择具有最小最低开销的网关
 	4. 从转发表确定通往最低开销网关的接口 I 。在转发表中加入表项 (x, I)

热土豆路由选择依据的思想是：尽可能快地将分组送出其 AS，而不担心其 AS 外部到目的地的余下部分的开销。

* 路由器选择算法

对于任何给定的目的地前缀，进入 BGP 的路由选择算法的输入是到某前缀的所有路由的集合，该前缀是已被路由器学习和接受的。

如果相同的前缀有两条或多条路由，则顺序地调用下列消除规则知道余下一条路由：

1. 路由器被指派一个**本地偏好**值作为其属性之一。具有最高本地偏好值的路由将被选择。

2. 从余下的路由中，选择具有最短 AS-PATH 的路由。（如果该规则是路由选择的唯一规则，则 BGP 将使用距离向量算法决定路径，其中距离测度使用 **AS 跳的跳数**而不是路由器跳的跳数。）

3. 从余下的路由中（所有都具有相同的最高本地偏好值和相同的 AS-PATH 长度），使用热土豆路由选择，即选择具有最靠近 NEXT-HOP 路由器的路由。

BGP 不再是一种自私的算法，即它先查找具有短 AS 路径的路由。

* IP 任播(待学习)

## SDN 控制平面 （待学习）