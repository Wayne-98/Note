---
title: 自顶向下方法：网络层-数据平面
date: {date}
tags: 计算机网络
categories: 计算机网络
---

##  路由器工作原理

* 输入端口
  * 最长前缀匹配规则：在路由表中寻找最长的匹配项，并向与最长前缀匹配相关联的链路转发分组
  * 三态内容可寻址存储器：线性时间内找到匹配项
* 交换结构
  * 经内存交换
  * 经总线交换
  * 经互联网络交换：纵横式交换
* 输出端口
* 路由选择处理器或者是 SND

* 分组调度
  * 先进先出
  * 优先权排队
  * 循环和加权公平排队

## 网际协议：IPv4、寻址、IPv6 及其他

* IPv4 数据报格式

![](https://github.com/Wayne-98/image/blob/master/Internet/IPv4%E6%95%B0%E6%8D%AE%E6%8A%A5%E6%A0%BC%E5%BC%8F.jpg?raw=true)

* IPv4 数据分片

生成一个数据报时，发送主机为该数据报设置源和目的地址的同时加上标识号。路由器需要分片的时候，形成的每一个数据报都具有相同的源和目的地址以及标识号。

标志位为 0 代表着这是较大数据报分片后的最后一片。

为了让目的主机确定是否丢失了一个片，使用偏移字段指定该片应放在初始 IP 数据报的哪个位置。

* IPv4 编址
  * 点分十进制
  * 子网掩码：/ 左侧定义了子网地址
  * 无类别域间路由(Classless Interdomain Routing, CIDR)：a . b . c . d / x
  * 分类编址：IP 地址的网络部分被限制为长度为 8A, 16B, 或 24C 比特
    * / 24 C : 仅仅能容纳 254台主机
    * / 16 B : 65534

* 获取地址：

  * 获取一块地址：ISP, 因特网名字和编号分配机构(Internet Corporation for Assigned Names and Numbers, ICANN)
  * 获取主机地址：动态主机配置协议(Dynamic Host Configuration, DHCP)

* DHCP：

  * 一个客户-服务器协议。通常每个子网都有一台 DHCP 服务器，如果子网中没有服务器，则需要一个 DHCP 中继代理(路由器)。

  * DHCP 运行步骤
    1. DHCP 服务器发现：DHCP 发现报文，客户在 UDP 分组中向端口 67 发送该发现报文。目的IP 地址使用广播地址 255.255.255.255，源 IP 地址为 0.0.0.0.
    2. DHCP 服务器提供：DHCP 服务器收到一个 DHCP 发现报文时，用 DHCP 提供报文向客户响应。目的 IP 地址仍然是广播地址。提供报文中还包含有收到发现报文的事务 ID, 向客户推荐的 IP 地址、网络掩码以及 IP 地址租用期。
    3. DHCP 请求：客户从收到的一个或多个服务器提供中选择一个，向选中的服务器提供用 DHCP 请求报文进行响应，回显配置的参数
    4. DHCP ACK：服务器用 DHCP ACK 报文对 DHCP 请求报文进行响应，证实所要求的参数。

* 网络地址转换 NAT：

  路由器上的一张 NAT 转换表，表项中包含了端口号及其 IP 地址。



* IPv6 数据报格式

![](https://github.com/Wayne-98/image/blob/master/Internet/IPv6.png?raw=true)

* IPv6 的向后兼容：隧道技术
* 通用转发和 SND(待学习)